---
export const prerender = true;

import { Picture, getImage } from "astro:assets";
import Layout from "../layouts/Layout.astro";
import ContactForm from "../components/ContactForm";

// Import about/profile image
const aboutImageFiles = import.meta.glob<{ default: ImageMetadata }>(
  "../assets/about/*.{jpg,jpeg,png,webp,avif}",
  { eager: true }
);
const aboutImage = Object.values(aboutImageFiles)[0]?.default;

// Import all images from the gallery folder
const galleryImageFiles = import.meta.glob<{ default: ImageMetadata }>(
  "../assets/gallery/*.{jpg,jpeg,png,webp,avif}",
  { eager: true }
);

// Sort by filename and prepare optimized images for PhotoSwipe
const galleryImages = await Promise.all(
  Object.values(galleryImageFiles).map(async (mod) => {
    const full = await getImage({ src: mod.default, width: 1800, quality: 90 });
    return {
      src: mod.default,
      fullSrc: full.src,
      fullWidth: full.attributes.width ?? mod.default.width,
      fullHeight: full.attributes.height ?? mod.default.height,
    };
  })
);
---

<Layout>
  <!-- ═══════════ NAWIGACJA ═══════════ -->
  <nav
    class="fixed top-0 left-0 z-50 w-full bg-white/90 shadow-sm backdrop-blur-sm"
  >
    <div class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4">
      <a
        href="#hero"
        class="font-display text-2xl font-semibold tracking-wide text-gold"
      >
        Fotografia Komunijna
      </a>
      <ul class="hidden items-center gap-8 font-body text-sm tracking-wide text-text-light md:flex">
        <li>
          <a
            href="#o-mnie"
            class="relative py-1 transition-colors hover:text-gold after:absolute after:bottom-0 after:left-0 after:h-[2px] after:w-0 after:bg-gold-light after:transition-all after:duration-300 hover:after:w-full"
          >
            O mnie
          </a>
        </li>
        <li>
          <a
            href="#galeria"
            class="relative py-1 transition-colors hover:text-gold after:absolute after:bottom-0 after:left-0 after:h-[2px] after:w-0 after:bg-gold-light after:transition-all after:duration-300 hover:after:w-full"
          >
            Galeria
          </a>
        </li>
        <li>
          <a
            href="#kontakt"
            class="rounded-md border border-gold bg-transparent px-5 py-2 font-display text-sm font-medium text-gold transition-all duration-300 hover:bg-gold hover:text-white"
          >
            Kontakt
          </a>
        </li>
      </ul>
      <!-- Mobile hamburger -->
      <button
        id="mobile-menu-btn"
        class="flex flex-col gap-1.5 md:hidden"
        aria-label="Menu"
      >
        <span class="block h-0.5 w-6 bg-gold transition-transform"></span>
        <span class="block h-0.5 w-6 bg-gold transition-opacity"></span>
        <span class="block h-0.5 w-6 bg-gold transition-transform"></span>
      </button>
    </div>
    <!-- Mobile menu -->
    <div
      id="mobile-menu"
      class="hidden flex-col items-center gap-4 border-t border-cream-dark bg-white px-6 py-6 md:hidden"
    >
      <a href="#o-mnie" class="font-body text-text-light hover:text-gold">O mnie</a>
      <a href="#galeria" class="font-body text-text-light hover:text-gold">Galeria</a>
      <a
        href="#kontakt"
        class="rounded-md border border-gold px-5 py-2 font-display text-sm font-medium text-gold hover:bg-gold hover:text-white"
      >
        Kontakt
      </a>
    </div>
  </nav>

  <main>
    <!-- ═══════════ HERO ═══════════ -->
    <section
      id="hero"
      class="relative flex min-h-[70vh] flex-col items-center justify-center bg-cream px-6 pt-16 pb-6 text-center"
    >
      <div class="absolute inset-0 overflow-hidden">
        <div
          class="absolute top-1/4 left-1/2 h-96 w-96 -translate-x-1/2 rounded-full bg-gold-light/10 blur-3xl"
        >
        </div>
        <div
          class="absolute bottom-1/4 right-1/4 h-64 w-64 rounded-full bg-gold-pale/20 blur-2xl"
        >
        </div>
      </div>

      <div class="relative z-10 max-w-4xl">
        <p
          class="mb-4 font-body text-sm uppercase tracking-[0.3em] text-gold-accent"
        >
          Profesjonalna fotografia
        </p>
        <h1
          class="font-display text-5xl font-medium italic leading-tight text-gold sm:text-6xl md:text-7xl lg:text-8xl"
        >
          Pierwsza Komunia
          <span class="block">Święta</span>
        </h1>

        <div class="ornament my-5">
          <span class="text-2xl text-gold-light">✦</span>
        </div>

        <p
          class="mx-auto max-w-xl font-body text-lg leading-relaxed text-text-light"
        >
          Uwiecznij ten wyjątkowy dzień Twojego dziecka. Naturalne, pełne emocji
          zdjęcia, które będziecie wspominać przez lata.
        </p>

        <a
          href="#kontakt"
          class="mt-7 inline-block rounded-md bg-gold px-8 py-3.5 font-display text-lg font-medium tracking-wide text-white transition-all duration-300 hover:bg-gold-accent hover:shadow-lg hover:shadow-gold/20"
        >
          Zarezerwuj termin
        </a>
      </div>

    </section>

    <!-- ═══════════ O MNIE ═══════════ -->
    <section id="o-mnie" class="bg-white px-6 py-24 md:py-32">
      <div class="mx-auto max-w-5xl">
        <div class="mb-16 text-center">
          <p
            class="mb-3 font-body text-sm uppercase tracking-[0.25em] text-gold-accent"
          >
            Poznajmy się
          </p>
          <h2 class="font-display text-4xl font-light text-gold md:text-5xl">
            O mnie
          </h2>
          <div class="ornament mt-6">
            <span class="text-lg text-gold-light">✦</span>
          </div>
        </div>

        <div class="grid items-center gap-12 md:grid-cols-2">
          <div class="flex justify-center">
            <div
              class="relative h-[500px] w-80 overflow-hidden rounded-lg bg-cream shadow-lg"
            >
              {aboutImage && (
                <Picture
                  src={aboutImage}
                  formats={["avif", "webp"]}
                  fallbackFormat="jpg"
                  alt="Pani fotograf"
                  width={1280}
                  height={2000}
                  quality={95}
                  class="h-full w-full object-cover object-top"
                />
              )}
            </div>
          </div>

          <div class="space-y-5">
            <p class="font-body text-lg leading-relaxed text-text-light">
              Jestem zawodowym fotografem z wieloletnim doświadczeniem w uwiecznianiu najważniejszych chwil w życiu rodzin. Specjalizuję się w fotografii komunijnej, łącząc profesjonalizm z naturalnym, ciepłym podejściem.
            </p>
            <p class="font-body text-lg leading-relaxed text-text-light">
              Każda sesja to dla mnie wyjątkowa historia — dbam o to, by zdjęcia oddawały emocje i atmosferę tego szczególnego dnia. Wykonuję reportaże w kościele, na przyjęciach komunijnych, a także sesje fotograficzne w plenerze oraz w studio, tworząc pamiątkowe kadry, które będziecie wspominać z uśmiechem.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- ═══════════ GALERIA (PLACEHOLDER — Sanity CMS later) ═══════════ -->
    <section id="galeria" class="bg-cream px-6 pt-24 pb-10 md:pt-32 md:pb-14">
      <div class="mx-auto max-w-6xl">
        <div class="mb-16 text-center">
          <p
            class="mb-3 font-body text-sm uppercase tracking-[0.25em] text-gold-accent"
          >
            Portfolio
          </p>
          <h2 class="font-display text-4xl font-light text-gold md:text-5xl">
            Galeria
          </h2>
          <div class="ornament mt-6">
            <span class="text-lg text-gold-light">✦</span>
          </div>
        </div>

        <div id="masonry-gallery" class="pswp-gallery mx-auto">
          {
            galleryImages.map((img, i) => (
              <a
                href={img.fullSrc}
                data-pswp-width={img.fullWidth}
                data-pswp-height={img.fullHeight}
                target="_blank"
                rel="noreferrer"
                class="masonry-item group relative mb-4 block overflow-hidden rounded-lg bg-cream-dark shadow-md transition-[box-shadow,transform] duration-500 hover:shadow-xl hover:-translate-y-1"
              >
                <Picture
                  src={img.src}
                  formats={["avif", "webp"]}
                  fallbackFormat="jpg"
                  alt={`Zdjęcie komunijne ${i + 1}`}
                  width={600}
                  height={800}
                  quality={90}
                  class="block w-full object-cover transition-transform duration-500 group-hover:scale-105"
                  loading={i < 4 ? "eager" : "lazy"}
                />
                <div class="absolute inset-0 bg-gradient-to-t from-gold/10 to-transparent opacity-0 transition-opacity duration-500 group-hover:opacity-100" />
              </a>
            ))
          }
        </div>
      </div>
    </section>

    <!-- ═══════════ KONTAKT ═══════════ -->
    <section id="kontakt" class="bg-cream px-6 pt-10 pb-24 md:pt-14 md:pb-32">
      <div class="mx-auto max-w-5xl">
        <div class="mb-16 text-center">
          <p
            class="mb-3 font-body text-sm uppercase tracking-[0.25em] text-gold-accent"
          >
            Napisz do mnie
          </p>
          <h2 class="font-display text-4xl font-light text-gold md:text-5xl">
            Kontakt
          </h2>
          <div class="ornament mt-6">
            <span class="text-lg text-gold-light">✦</span>
          </div>
          <p class="mx-auto mt-6 max-w-lg font-body text-text-light">
            Zainteresowany sesją komunijną? Wypełnij formularz, a odezwę się do
            Ciebie w ciągu 24 godzin.
          </p>
        </div>

        <ContactForm client:load />
      </div>
    </section>
  </main>

  <!-- ═══════════ STOPKA ═══════════ -->
  <footer class="border-t border-cream-dark bg-white px-6 py-12">
    <div class="mx-auto max-w-5xl text-center">
      <!-- Brand -->
      <h3 class="mb-3 font-display text-xl font-semibold text-gold">
        Fotografia Komunijna
      </h3>
      <p class="font-body text-sm leading-relaxed text-text-light">
        Profesjonalna fotografia Pierwszej Komunii Świętej.
        Uwieczniamy najważniejsze chwile.
      </p>

      <!-- Contact details -->
      <h4
        class="mt-8 mb-3 font-display text-sm font-medium uppercase tracking-widest text-gold-accent"
      >
        Kontakt
      </h4>
      <ul class="space-y-2 font-body text-sm text-text-light">
        <li>
          <a href="mailto:pieknafotografia@gmail.com" class="hover:text-gold transition-colors">
            pieknafotografia@gmail.com
          </a>
        </li>
        <li>
          <a href="tel:+48509600680" class="hover:text-gold transition-colors">
            509 600 680
          </a>
        </li>
        <li>Cała Polska</li>
      </ul>

      <!-- Copyright -->
      <div
        class="mt-10 border-t border-cream-dark pt-6 font-body text-xs text-text-light/60"
      >
        © <span id="copyright-year"></span> Fotografia Komunijna. Wszelkie prawa
        zastrzeżone.
      </div>
    </div>
  </footer>

  <script src="../scripts/mobile-menu.ts"></script>
  <script src="../scripts/gallery.ts"></script>
</Layout>
